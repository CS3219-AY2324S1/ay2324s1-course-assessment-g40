<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <style>
        .question-description-id{
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
        max-width: 300px;
        max-height: 100px;
        }

        mark {
        background: none;
        }

        .modal-dialog
        {
            background: white !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-3">Magic Question Machine</h1>
        <hr>
        <div class="row">
            <div class="col-6">
                <h2 id="title">Add a Question</h2>
                <form id="questionForm">
                    <label for="name" class="mb-3">Question Title :</label>
                    <input type="text" name="name" id="qtitle" class="form-control" required>
                    <br>
                    <label for="description" class="mb-3">Question Description :</label>
                    <textarea
                        type="text"
                        name="description"
                        id="qdesc"
                        class="form-control"
                        required
                        placeholder="Write your description in HTML..."
                        >
                    </textarea>
                    <br>
                    <label for="category" class="mb-3">Question Category :</label>
                        <input type="text" name="category" id="qcategory" class="form-control" required>
                    <br>
                    <label for="complexity" class="mb-3">Question Complexity :</label>
                    <select name="complexity" id="qcomplexity" class="form-control" required>
                        <option value="Easy" selected>Easy</option>
                        <option value="Medium">Medium</option>
                        <option value="Hard">Hard</option>
                    </select>
                    <br>
                    <button type="submit" class="btn btn-primary">Save Question</button>
                </form>
                <hr>
                <div class="table-responsive">
                  <table class="table table-bordered table-striped table-hover" id="table">
                    <thead class="thead-dark">
                      <tr>
                        <th>Question ID</th>
                        <th>Question Title</th>
                        <th>Question Description</th>
                        <th>Question Category</th>
                        <th>Question Complexity</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                  </table>
                  </div>
                </div>
                <div id="view" class="col-6">
                </div>
            </div>
        </div>
    <script>
        let questions = localStorage.getItem("qs")

        if(!questions) {
            questions = [];
        } else{
            questions = JSON.parse(questions);
        }

        function saveQuestions() {
            localStorage.setItem("qs", JSON.stringify(questions));
        }

        function renderItemList() {
            const itemList = document.getElementById('table');
            itemList.innerHTML = `<thead class="thead-dark">
                  <tr>
                    <th>Question ID</th>
                    <th>Question Title</th>
                    <th>Question Description</th>
                    <th>Question Category</th>
                    <th>Question Complexity</th>
                    <th>Actions</th>
                  </tr>
                </thead>`
            itemList.innerHTML += `<tbody>`;
            questions.forEach((item, index) => {
                var text = item.description.replace(/<\s*br[^>]?>/,'\n')
                 .replace(/(<([^>]+)>)/g, "");
                itemList.innerHTML += `
                <tr onclick="view(${index})">
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td class="question-description-id">${text}</td>
                    <td>${item.category}</td>
                    <td>${item.complexity}</td>
                    <td>
                        <button class="btn btn-outline-primary" onclick="edit(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteItem(${index})">Delete</button>
                    </td>
                <tr>
                `;

            });
            itemList.innerHTML += `</tbody>`;
            // Save the questions to localStorage whenever the list is updated
            saveQuestions();
        }

        function edit(index) {
            document.getElementById('title').innerText = `Edit Question ${index + 1}`
            var item = questions[index]
            let itemNameInput = document.getElementById('qtitle');
            let itemDescriptionInput = document.getElementById('qdesc');
            let itemCategory = document.getElementById('qcategory');
            let itemComplexity = document.getElementById('qcomplexity');
            itemNameInput.value = item.name
            itemDescriptionInput.value = item.description
            itemCategory.value = item.category
            itemComplexity.value = item.complexity
            var form = document.getElementById('questionForm')
            form.removeEventListener('submit', addItem)
            form.addEventListener('submit', () => editItem(index))
        }

        function addItem(event) {
            event.preventDefault();
            let itemNameInput = document.getElementById('qtitle');
            let itemDescriptionInput = document.getElementById('qdesc');
            let itemCategory = document.getElementById('qcategory');
            let itemComplexity = document.getElementById('qcomplexity');
            const newItemName = itemNameInput.value.trim();
            const newItemDescription = itemDescriptionInput.value;
            const newItemCategory = itemCategory.value.trim();
            const newItemComplexity = itemComplexity.value.trim();
            let dup = false
            questions.forEach((q) => {
                if (q["name"] == newItemName) {
                dup = true
                return
                }
            })
            if (dup) {
                alert("Duplicate Question Title! Please try again")
                return
            }
            if (!dup && newItemName !== '' && newItemDescription !== '') {
                questions.push({ name: newItemName, description: newItemDescription, category: newItemCategory, complexity: newItemComplexity });
                itemNameInput.value = '';
                itemDescriptionInput.value = '';
                itemCategory.value = '';
                itemComplexity = '';
                renderItemList();
            }
        }

        function view(i) {
            const viewElem = document.getElementById('view');
            const questionToView = questions[i];
            viewElem.innerHTML = `
            <h3>Title: ${questionToView.name}</h3>
            <p>Current Question ID: ${i + 1}<p>
            <div style=white-space:pre-line; >${questionToView.description}</div>
            <p>Current Question Category: ${questionToView.category}<p>
            <p>Current Question Complexity: ${questionToView.complexity}<p>
            `
        }

    function editItem(index) {
        let itemNameInput = document.getElementById('qtitle');
        let itemDescriptionInput = document.getElementById('qdesc');
        let itemCategory = document.getElementById('qcategory');
        let itemComplexity = document.getElementById('qcomplexity');
        const newItemName = itemNameInput.value.trim();
        const newItemDescription = itemDescriptionInput.value;
        const newItemCategory = itemCategory.value.trim();
        const newItemComplexity = itemComplexity.value.trim();
        let dup = false
        questions.forEach((q, i) => {
            if (i != index && q["name"] == newItemName) {
            dup = true
            return
            }
        })
        if (dup) {
            alert("Duplicate Question Title! Please try again")
            var form = document.getElementById('questionForm')
            form.removeEventListener('submit', editItem)
            form.addEventListener('submit', addItem)
            return
        }
        if (newItemName !== '' && newItemDescription !== '') {
            questions[index] = { name: newItemName, description: newItemDescription, category: newItemCategory, complexity: newItemComplexity };
            itemNameInput.value = '';
            itemDescriptionInput.value = '';
            itemCategory.value = '';
            itemComplexity = '';
            renderItemList();
        }
        document.getElementById('title').innerText = `Add Question`
        var form = document.getElementById('questionForm')
        form.removeEventListener('submit', editItem)
        form.addEventListener('submit', addItem)
    }

    function deleteItem(index) {
        const confirmDelete = confirm('Are you sure you want to delete this item?');
        if (confirmDelete) {
            questions.splice(index, 1);
            renderItemList();
        }
    }

    const questionForm = document.getElementById('questionForm');
    questionForm.addEventListener('submit', addItem);

    renderItemList();
    </script>
</body>
</html>
